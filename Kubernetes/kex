#!/bin/bash

# sudo wget https://raw.githubusercontent.com/astbss/astbss/master/Kubernetes/kex -O /usr/local/bin/kex ; sudo chmod +x /usr/local/bin/kex

# https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-autocomplete
# Enable kubernetes completion via adding this to your ~/.bashrc
# alias k=kubectl
# source <(kubectl completion bash)
# complete -F __start_kubectl k

# https://kubernetes.io/docs/reference/kubectl/cheatsheet/
# https://gist.github.com/tamas-molnar/32a07c0eb83e95484e3cdb4b7fada32b
# https://www.sfgroups.com/kubernetes/kubectl_bash_alias/
# https://itnext.io/kubernetes-command-line-tools-acad11683794


# set -xv
# set -ex
# set -e stops the execution of a script if a command or pipeline has an error
# set -v Echoes all commands before executing
# set -x 	Similar to -v, but expands commands
# https://www.tldp.org/LDP/abs/html/options.html

# Simple Login to Pod Bash Script
# cp kex /usr/local/bin/kex

P="$1"
D=""

case $P in
  (n|node|nodes)
    echo "kubectl get nodes"
    kubectl get nodes
    exit
  ;; # OK
esac

# https://kubernetes.io/docs/tasks/access-application-cluster/list-all-running-container-images/
case $P in
  (l|list|pod|pods)
    kubectl get pods -o=jsonpath='{range .items[*]}{"\n"}{.metadata.name}{":\t"}{range .spec.containers [*]}{.name}{", "}{end}{end}' | sort
    exit
  ;; # OK
esac

case $P in
  (c|co|containers)
    kubectl get pods -o=jsonpath='{range .items[*]}{"\n"}{.metadata.name}{":\t"}{range .spec.containers[*]}{.image}{", "}{end}{end}' | sort
    exit
  ;; # OK
esac

kubectl get pods --all-namespaces -o=jsonpath='{range .items[*]}{"\n"}{.metadata.name}{":\t"}{range .spec.containers[*]}{.image}{", "}{end}{end}' | sort



# -n True if the length of string is non-zero
if [ -n "$P" ] ; then
  D=$(kubectl get pods | grep $P | cut -f1 -d' ')
else
  kubectl get pods -o=wide
  exit  
fi

echo "Pod Name: $D"

if [ -n "$2" ] ; then
  kubectl exec  "$D" -it --container $2 -- bash -il
else
  kubectl exec  "$D" -it -- bash -il
fi
